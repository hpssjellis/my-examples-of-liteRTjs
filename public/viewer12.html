<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>TFLite Model Inspector (Offline)</title>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* Base styles - Replaces Tailwind defaults */
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;Â 
Â  Â  Â  Â  Â  Â  background-color: #f7f7f7;Â 
Â  Â  Â  Â  Â  Â  padding: 16px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .container {Â 
Â  Â  Â  Â  Â  Â  max-width: 960px;Â 
Â  Â  Â  Â  Â  Â  margin: 0 auto;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Card styles - Replaces Tailwind card classes */
Â  Â  Â  Â  .card {Â 
Â  Â  Â  Â  Â  Â  background-color: white;Â 
Â  Â  Â  Â  Â  Â  padding: 24px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 12px;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
Â  Â  Â  Â  Â  Â  border: 1px solid #e5e7eb;
Â  Â  Â  Â  Â  Â  margin-bottom: 32px;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .card:hover {Â 
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Status colors */
Â  Â  Â  Â  .status { padding: 12px; border-radius: 8px; font-weight: 500; margin-bottom: 16px; border: 1px solid; }
Â  Â  Â  Â  .status-loaded { background-color: #d1fae5; color: #065f46; border-color: #34d399; }
Â  Â  Â  Â  .status-error { background-color: #fee2e2; color: #991b1b; border-color: #f87171; }
Â  Â  Â  Â  .status-info { background-color: #eff6ff; color: #1e40af; border-color: #60a5fa; }

Â  Â  Â  Â  /* Input and Button styles */
Â  Â  Â  Â  .input-text {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  padding: 12px;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid #d1d5db;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  box-sizing: border-box;Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 16px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .input-file { margin-bottom: 16px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .button {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  padding: 12px 16px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  transition: background-color 0.15s;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  }
Â  Â  Â  Â  .button-purple { background-color: #8b5cf6; color: white; }
Â  Â  Â  Â  .button-purple:hover { background-color: #7c3aed; }
Â  Â  Â  Â  .button-blue { background-color: #3b82f6; color: white; margin-top: 24px; }
Â  Â  Â  Â  .button-blue:hover { background-color: #2563eb; }
Â  Â  Â  Â  .button:disabled { background-color: #ccc; cursor: not-allowed; }

Â  Â  Â  Â  /* Typography */
Â  Â  Â  Â  h1 { font-size: 1.875rem; font-weight: 800; text-align: center; color: #1f2937; margin-bottom: 24px; }
Â  Â  Â  Â  h2 { font-size: 1.5rem; font-weight: 600; color: #6d28d9; margin-bottom: 16px; display: flex; align-items: center; }
Â  Â  Â  Â  .label { display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 4px; }
Â  Â  Â  Â  .text-detail { font-size: 0.875rem; color: #4b5563; margin-bottom: 32px; text-align: center; }

Â  Â  Â  Â  /* Results blocks */
Â  Â  Â  Â  .result-block {Â 
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6;Â 
Â  Â  Â  Â  Â  Â  padding: 12px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  font-family: monospace;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.875rem;Â 
Â  Â  Â  Â  Â  Â  word-break: break-all;
Â  Â  Â  Â  Â  Â  margin-top: 12px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Layout & Icon Fix */
Â  Â  Â  Â  .flex-row { display: flex; align-items: center; }
Â  Â  Â  Â  .flex-row svg {Â 
Â  Â  Â  Â  Â  Â  margin-right: 8px;Â 
Â  Â  Â  Â  Â  Â  /* FIX: Explicitly setting the size of the SVG icons */
Â  Â  Â  Â  Â  Â  width: 24px;Â 
Â  Â  Â  Â  Â  Â  height: 24px;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  .layer-list {
Â  Â  Â  Â  Â  Â  list-style: none;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .layer-item {
Â  Â  Â  Â  Â  Â  padding: 8px;
Â  Â  Â  Â  Â  Â  border-bottom: 1px solid #e5e7eb;
Â  Â  Â  Â  }
Â  Â  Â  Â  .layer-item:last-child {
Â  Â  Â  Â  Â  Â  border-bottom: none;
Â  Â  Â  Â  }
        /* Utility for hiding elements */
        .hidden { display: none; }

Â  Â  </style>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-tflite@0.0.1-alpha.9/dist/tf-tflite.min.js"></script>
</head>
<body class="p-4 md:p-8">

Â  Â  <div class="container">
Â  Â  Â  Â  <h1>TFLite Model Inspector (Offline Ready)</h1>
Â  Â  Â  Â  <p class="text-detail">Load your local `.tflite` file or a URL, define the expected input shape, and verify the model's output signature.</p>

Â  Â  Â  Â  <div id="loading-section" class="card">
Â  Â  Â  Â  Â  Â  <h2 class="flex-row">
Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  1. Load Model
Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  <div id="model-status" class="status status-info">Awaiting model file or URL...</div>

Â  Â  Â  Â  Â  Â  <label for="model-file" class="label">
                Load from Local File (.tflite) ðŸ‘ˆ **Selecting a file here now automatically starts the load process.**
            </label>
Â  Â  Â  Â  Â  Â  <input type="file" id="model-file" class="input-file" accept=".tflite">

Â  Â  Â  Â  Â  Â  <p style="text-align: center; margin: 10px 0; font-style: italic;">--- OR ---</p>

Â  Â  Â  Â  Â  Â  <label for="model-url" class="label">Load from URL (Requires Network)</label>
Â  Â  Â  Â  Â  Â  <input type="text" id="model-url" class="input-text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value="./tflite/ei-w7-8-esp32-accel-words-both-better-nn-classifier-tensorflow-lite-float32-model.38.tflite"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="Enter the URL of your .tflite file">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button onclick="loadModel(true)" id="load-button" class="button button-purple">
Â  Â  Â  Â  Â  Â  Â  Â  Load URL and Inspect
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="inspection-section" class="card hidden">
Â  Â  Â  Â  Â  Â  <h2 class="flex-row">
Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-9 0V3h4v2m-4 0h4"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  2. Model Topology & Signature
Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="model-topology">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-top: 0; margin-bottom: 8px;">Model Topology</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="layer-count-summary" class="status status-info">Layer Count: N/A</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="result-block" style="margin-top: 8px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong style="color: #6d28d9;">First 3 Operations (Type: Name)</strong>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul id="layer-details-list" class="layer-list" style="margin-top: 4px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li class="layer-item">Waiting for model load...</li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-detail" style="text-align: left; margin-top: 16px; margin-bottom: 8px; font-style: normal;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  **NOTE:** This extraction relies on non-public properties of the TFLite runtime. For the complete, raw model graph (all layers/operations), check the **Developer Console (F12)** and navigate the logged object: **`tfliteModel` â†’ `executor_` â†’ `graph_` â†’ `nodes`**.
Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <hr style="margin: 20px 0; border: 0; border-top: 1px solid #e5e7eb;">

Â  Â  Â  Â  Â  Â  <div id="model-signature" style="margin-bottom: 16px;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-top: 0; margin-bottom: 8px;">Input/Output Signature</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-detail" style="text-align: left; margin-bottom: 16px; margin-top: 0;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Enter the exact input shape your model expects for a successful dry run.
Â  Â  Â  Â  Â  Â  Â  Â  </p>

Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="input-shape" class="label">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Expected Input Shape (e.g., `1, 260` for the current model)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="input-shape" class="input-text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="Enter comma-separated dimensions, e.g., 1,260" value="1, 260">
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div id="input-summary" class="status status-info result-block">Input Shape Placeholder</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="output-summary" class="status status-info result-block">Output Shape Placeholder</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <button onclick="runInference()" id="run-button" class="button button-blue" disabled>
Â  Â  Â  Â  Â  Â  Â  Â  3. Run Test Inference
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="output-section" class="card hidden">
Â  Â  Â  Â  Â  Â  <h2 class="flex-row">
Â  Â  Â  Â  Â  Â  Â  Â  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.857L13 21l-2.286-6.857L5 12l5.714-2.857L13 3z"></path></svg>
Â  Â  Â  Â  Â  Â  Â  Â  4. Inference Results
Â  Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  Â  Â  <div id="inference-status" class="status status-info">Run the test inference to see results.</div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div style="margin-top: 12px; display: flex; flex-direction: column; gap: 12px;">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="output-shape-result" class="result-block">Output Shape: N/A</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="output-data-preview" class="result-block">Data Preview (First 10 values): N/A</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // Global variables
Â  Â  Â  Â  let tfliteModel = null;
Â  Â  Â  Â  const statusEl = document.getElementById('model-status');
Â  Â  Â  Â  const loadBtn = document.getElementById('load-button');
Â  Â  Â  Â  const runBtn = document.getElementById('run-button');
Â  Â  Â  Â  const inspectionSection = document.getElementById('inspection-section');
Â  Â  Â  Â  const outputSection = document.getElementById('output-section');
Â  Â  Â  Â  const modelFileEl = document.getElementById('model-file');Â 
Â  Â  Â  Â  const modelUrlEl = document.getElementById('model-url');Â 
Â  Â  Â  Â  const inputShapeEl = document.getElementById('input-shape');
Â  Â  Â  Â  const inputSummaryEl = document.getElementById('input-summary');
Â  Â  Â  Â  const outputSummaryEl = document.getElementById('output-summary');
Â  Â  Â  Â  const outputShapeResultEl = document.getElementById('output-shape-result');
Â  Â  Â  Â  const outputDataPreviewEl = document.getElementById('output-data-preview');
Â  Â  Â  Â  const inferenceStatusEl = document.getElementById('inference-status');
Â  Â  Â  Â  const layerCountSummaryEl = document.getElementById('layer-count-summary');
Â  Â  Â  Â  const layerDetailsListEl = document.getElementById('layer-details-list');


Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Utility function to update the main status message block.
Â  Â  Â  Â  Â * @param {string} message - The message to display.
Â  Â  Â  Â  Â * @param {string} type - 'info', 'loaded', or 'error'.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function updateStatus(message, type = 'info') {
Â  Â  Â  Â  Â  Â  statusEl.textContent = message;
Â  Â  Â  Â  Â  Â  statusEl.className = 'status ';
Â  Â  Â  Â  Â  Â  statusEl.classList.add(`status-${type}`);
Â  Â  Â  Â  Â  Â  console.log(`STATUS [${type.toUpperCase()}]: ${message}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Clears all dynamic information sections.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function resetView() {
Â  Â  Â  Â  Â  Â  tfliteModel = null;
Â  Â  Â  Â  Â  Â  inspectionSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  outputSection.classList.add('hidden');
Â  Â  Â  Â  Â  Â  inputSummaryEl.textContent = 'Input Shape Placeholder';
Â  Â  Â  Â  Â  Â  outputSummaryEl.textContent = 'Output Shape Placeholder';
Â  Â  Â  Â  Â  Â  layerCountSummaryEl.textContent = 'Layer Count: N/A';
Â  Â  Â  Â  Â  Â  layerDetailsListEl.innerHTML = '<li class="layer-item">Waiting for model load...</li>';
Â  Â  Â  Â  Â  Â  outputShapeResultEl.textContent = 'Output Shape: N/A';
Â  Â  Â  Â  Â  Â  outputDataPreviewEl.textContent = 'Data Preview (First 10 values): N/A';
Â  Â  Â  Â  Â  Â  inferenceStatusEl.textContent = 'Run the test inference to see results.';
Â  Â  Â  Â  Â  Â  runBtn.disabled = true;
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Reads a local file into an ArrayBuffer using FileReader.
Â  Â  Â  Â  Â * @param {File} file - The file object to read.
Â  Â  Â  Â  Â * @returns {Promise<ArrayBuffer>}
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function readFileAsArrayBuffer(file) {
Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = () => resolve(reader.result);
Â  Â  Â  Â  Â  Â  Â  Â  reader.onerror = (error) => reject(error);
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsArrayBuffer(file);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * Attempts to extract layer/operation details from the internal GraphModel structure.
Â  Â  Â  Â  Â * WARNING: Relies on non-public properties.
Â  Â  Â  Â  Â * @param {tf.GraphModel} model - The loaded TFLite model.
Â  Â  Â  Â  Â * @returns {{count: number, layers: Array<{op: string, name: string}>}}
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function getLayerDetails(model) {
Â  Â  Â  Â  Â  Â  let layerInfo = [];
Â  Â  Â  Â  Â  Â  let layerCount = 0;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Accessing the internal graph structure through the executor
Â  Â  Â  Â  Â  Â  Â  Â  const graph = model.executor && model.executor.graph;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (graph && graph.nodes) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // graph.nodes is an object where keys are node names (operations)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const nodeName in graph.nodes) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const node = graph.nodes[nodeName];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extract operation type and node name
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layerInfo.push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: nodeName,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  op: node.op,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layerCount++;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layerInfo.push({ op: "ERROR", name: "Internal graph structure not found." });
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error attempting to parse internal model structure:", e);
Â  Â  Â  Â  Â  Â  Â  Â  layerInfo = [{ op: "ERROR", name: "Parsing failed: " + e.message }];
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return { count: layerCount, layers: layerInfo };
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * 1. Loads the TFLite model from the provided file or URL.
         * @param {boolean} isManualUrlLoad - True if called by the URL button, false otherwise (e.g., file input change).
Â  Â  Â  Â  Â */
Â  Â  Â  Â  async function loadModel(isManualUrlLoad = false) {
Â  Â  Â  Â  Â  Â  resetView();
Â  Â  Â  Â  Â  Â  loadBtn.disabled = true;

Â  Â  Â  Â  Â  Â  const selectedFile = modelFileEl.files[0];
Â  Â  Â  Â  Â  Â  const url = modelUrlEl.value.trim();
Â  Â  Â  Â  Â  Â  let modelSource = null;

Â  Â  Â  Â  Â  Â  if (selectedFile) {
Â  Â  Â  Â  Â  Â  Â  Â  // Load from file: Highest priority
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Reading local file: ${selectedFile.name}...`, 'info');
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modelSource = await readFileAsArrayBuffer(selectedFile);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Clear the URL input to ensure only the file is loaded
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modelUrlEl.value = '';Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Error reading file: ${error.message}`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  loadBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else if (url && isManualUrlLoad) { // Only load URL if the button was explicitly pressed
Â  Â  Â  Â  Â  Â  Â  Â  // Load from URL (requires network)
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Loading model from URL: ${url}...`, 'info');
Â  Â  Â  Â  Â  Â  Â  Â  modelSource = url;
Â  Â  Â  Â  Â  Â  Â  Â  // Clear the file input to ensure only the URL is loaded
                // Note: The file input value is read-only for security, but this signals what was loaded.
Â  Â  Â  Â  Â  Â  Â  Â  modelFileEl.value = '';Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // This block handles the case where neither a file is selected nor the URL button is pressed.
                // In the case of the file change event, if there's no file, it simply returns.
                // If it's a button press with no URL, it shows an error.
                if (isManualUrlLoad) {
                    updateStatus('Error: Please select a file or enter a model URL.', 'error');
                } else {
                    updateStatus('Awaiting model file or URL...', 'info');
                }
Â  Â  Â  Â  Â  Â  Â  Â  loadBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

            if (!modelSource) {
                // If we reach here, something is wrong, but the previous checks should catch it.
                loadBtn.disabled = false;
                return;
            }


Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // Initialize tfjs-tflite Wasm path (required for tflite.loadTFLiteModel to work)
Â  Â  Â  Â  Â  Â  Â  Â  if (typeof tflite.setWasmPath === 'function') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tflite.setWasmPath('https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-tflite@0.0.1-alpha.9/dist/');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Load the model from the source (ArrayBuffer or URL string)
Â  Â  Â  Â  Â  Â  Â  Â  tfliteModel = await tflite.loadTFLiteModel(modelSource);

Â  Â  Â  Â  Â  Â  Â  Â  updateStatus('Model loaded successfully! See inspection below.', 'loaded');
Â  Â  Â  Â  Â  Â  Â  Â  loadBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // --- CONSOLE OUTPUT FOR ANALYSIS OBJECT ---
Â  Â  Â  Â  Â  Â  Â  Â  console.log("--------------------------------------------------------------------");
Â  Â  Â  Â  Â  Â  Â  Â  console.log("MODEL ANALYSIS OBJECT (tfliteModel):");
Â  Â  Â  Â  Â  Â  Â  Â  console.log("To see the full TFLite graph structure (the layers/operations):");
Â  Â  Â  Â  Â  Â  Â  Â  console.log("1. Expand the object logged below.");
Â  Â  Â  Â  Â  Â  Â  Â  console.log("2. Follow the path: [tfliteModel] -> executor_ -> graph_ -> nodes");
Â  Â  Â  Â  Â  Â  Â  Â  console.log(tfliteModel);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("--------------------------------------------------------------------");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Show inspection sections
Â  Â  Â  Â  Â  Â  Â  Â  inspectionSection.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  runBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // Display input/output and topology details
Â  Â  Â  Â  Â  Â  Â  Â  inspectModel();

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  updateStatus(`Model Load Error: ${error.message}. Check file integrity, URL, and console for details.`, 'error');
Â  Â  Â  Â  Â  Â  Â  Â  console.error("TFLite Load Error:", error);
Â  Â  Â  Â  Â  Â  Â  Â  loadBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  runBtn.disabled = true;
Â  Â  Â  Â  Â  Â  Â  Â  tfliteModel = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * 2. Inspects and displays the expected input signature and model topology.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function inspectModel() {
Â  Â  Â  Â  Â  Â  if (!tfliteModel) return;

Â  Â  Â  Â  Â  Â  // --- Display Input/Output Placeholders ---
Â  Â  Â  Â  Â  Â  inputSummaryEl.className = 'status status-info result-block';
Â  Â  Â  Â  Â  Â  inputSummaryEl.textContent = `Input Tensor Shape: User-defined (e.g., [${inputShapeEl.value}])`;

Â  Â  Â  Â  Â  Â  outputSummaryEl.className = 'status status-info result-block';
Â  Â  Â  Â  Â  Â  outputSummaryEl.textContent = 'Output Tensor Shape: Unknown until test inference is run.';
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // --- Extract and Display Topology ---
Â  Â  Â  Â  Â  Â  const topology = getLayerDetails(tfliteModel);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  layerCountSummaryEl.textContent = `Total Operations (Nodes): ${topology.count}`;
Â  Â  Â  Â  Â  Â  layerCountSummaryEl.className = topology.count > 0 ? 'status status-loaded' : 'status status-error';

Â  Â  Â  Â  Â  Â  layerDetailsListEl.innerHTML = ''; // Clear existing list

Â  Â  Â  Â  Â  Â  if (topology.layers.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // Display the first 3 operations
Â  Â  Â  Â  Â  Â  Â  Â  topology.layers.slice(0, 3).forEach(layer => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const listItem = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.className = 'layer-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.textContent = `${layer.op.toUpperCase()}: ${layer.name}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layerDetailsListEl.appendChild(listItem);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (topology.layers.length > 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const moreItem = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  moreItem.className = 'layer-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  moreItem.style.fontStyle = 'italic';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  moreItem.textContent = `... and ${topology.layers.length - 3} more operations. Check console for full list.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  layerDetailsListEl.appendChild(moreItem);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  layerDetailsListEl.innerHTML = '<li class="layer-item">Could not automatically extract layer details.</li>';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  /**
Â  Â  Â  Â  Â * 3. Runs a dry inference with simulated data based on user input shape.
Â  Â  Â  Â  Â */
Â  Â  Â  Â  function runInference() {
Â  Â  Â  Â  Â  Â  if (!tfliteModel) {
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.textContent = 'Error: Model not loaded.';
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.className = 'status status-error';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Parse Input Shape
Â  Â  Â  Â  Â  Â  const shapeString = inputShapeEl.value.trim();
Â  Â  Â  Â  Â  Â  if (!shapeString) {
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.textContent = 'Error: Please specify the input shape (e.g., 1,260).';
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.className = 'status status-error';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Convert string '1, 260' to array [1, 260]
Â  Â  Â  Â  Â  Â  const inputShape = shapeString.split(',')
Â  Â  Â  Â  Â  Â  Â  Â  .map(s => s.trim())
Â  Â  Â  Â  Â  Â  Â  Â  .filter(s => s.length > 0)
Â  Â  Â  Â  Â  Â  Â  Â  .map(s => parseInt(s));

Â  Â  Â  Â  Â  Â  if (inputShape.length === 0 || inputShape.some(dim => isNaN(dim) || dim <= 0)) {
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.textContent = 'Error: Invalid input shape. Must be positive integers.';
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.className = 'status status-error';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  inferenceStatusEl.textContent = `Running inference with shape [${inputShape.join(', ')}]...`;
Â  Â  Â  Â  Â  Â  inferenceStatusEl.className = 'status status-info';
Â  Â  Â  Â  Â  Â  runBtn.disabled = true;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  tf.tidy(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 1. Create a dummy input tensor based on user shape
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const totalElements = inputShape.reduce((a, b) => a * b, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Create an array of mock data (using random noise scaled between -1 and 1)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mockData = Array.from({ length: totalElements }, () => Math.random() * 2 - 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Create the tensor (assume float32 for most TFLite models)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const inputTensor = tf.tensor(mockData, inputShape, 'float32');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- CONSOLE OUTPUT FOR ANALYSIS OBJECT (Input Tensor) ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Input Tensor (Check shape and dtype):", inputTensor);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 2. Run Prediction
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const outputTensor = tfliteModel.predict(inputTensor);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // --- CONSOLE OUTPUT FOR ANALYSIS OBJECT (Output Tensor) ---
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("Output Tensor (Check shape and dtype):", outputTensor);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 3. Display Results
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputSection.classList.remove('hidden');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const outputShape = outputTensor.shape;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const outputData = outputTensor.dataSync();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputShapeResultEl.textContent = `Output Shape: [${outputShape.join(', ')}]`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputDataPreviewEl.textContent = `Data Preview (First 10 values): [${Array.from(outputData).slice(0, 10).map(v => v.toFixed(4)).join(', ')}${outputData.length > 10 ? ', ...' : ''}]`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Update the Output Signature summary
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  outputSummaryEl.textContent = `Output Tensor Shape: [${outputShape.join(', ')}] (Type: ${outputTensor.dtype})`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Success status
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.textContent = 'Inference complete! Output data is shown below.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.className = 'status status-loaded';
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.textContent = `Inference Error: ${error.message}. This often means the input shape/data type is incorrect.`;
Â  Â  Â  Â  Â  Â  Â  Â  inferenceStatusEl.className = 'status status-error';
Â  Â  Â  Â  Â  Â  Â  Â  console.error("TFLite Inference Error:", error);
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  runBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  // Dispose any leftover variables
Â  Â  Â  Â  Â  Â  Â  Â  tf.disposeVariables();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- THE FIX: EVENT LISTENERS FOR AUTO-LOAD AND MANUAL URL LOAD ---

Â  Â  Â  Â  // 1. Auto-load on file selection
Â  Â  Â  Â  modelFileEl.addEventListener('change', () => {
Â  Â  Â  Â  Â  Â  if (modelFileEl.files.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  // Pass false for isManualUrlLoad since this is a file change
Â  Â  Â  Â  Â  Â  Â  Â  loadModel(false);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

        // 2. Change the button's onclick to pass 'true' to loadModel
        // The HTML has been updated: <button onclick="loadModel(true)" id="load-button" ...>
Â  Â  
Â  Â  </script>
</body>
</html>
